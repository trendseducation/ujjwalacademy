<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ujjwal Academy - Study Material App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome (free CDN) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root {
      --primary: #4e54c8;
      --primary-dark: #3a44d6;
      --primary-light: #e6e9ff;
      --secondary: #ff6b6b;
      --accent: #36d1dc;
      --text: #2d3748;
      --text-light: #718096;
      --background: #f8fafc;
      --card-bg: #ffffff;
      --success: #48bb78;
      --border-radius: 12px;
      --shadow: 0 10px 25px rgba(0,0,0,0.05);
      --shadow-hover: 0 15px 35px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: white;
      padding: 40px 0;
      border-radius: 0 0 30px 30px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
    }

    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
	  margin-left: 20px;
    }

    header p {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 600px;
 	  margin-left: 20px;
    }

    .app-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 30px;
      transition: var(--transition);
    }

    .app-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-5px);
    }

    .app-header {
      display: flex;
      gap: 20px;
      align-items: center;
      padding: 25px;
    }

    .app-icon {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      background: linear-gradient(145deg, var(--primary-light) 0%, var(--primary) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: white;
      box-shadow: 0 5px 15px rgba(78, 84, 200, 0.2);
    }

    .app-info h2 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--text);
    }

    .app-info p {
      color: var(--text-light);
      margin: 5px 0 0;
    }

    .app-stats {
      display: flex;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .stat {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 0.95rem;
      color: var(--text-light);
      background: var(--primary-light);
      padding: 8px 15px;
      border-radius: 20px;
    }

    .stat i {
      color: var(--primary);
    }

    .app-actions {
      padding: 0 25px 25px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .install-btn {
      background: linear-gradient(to right, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 15px 40px;
      border-radius: 15px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      box-shadow: 0 5px 15px rgba(78, 84, 200, 0.3);
    }

    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(78, 84, 200, 0.4);
    }

    .install-btn:disabled {
      opacity: .6;
      cursor: default;
      transform: none;
    }

    .view-details {
      color: var(--primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      transition: var(--transition);
    }

    .view-details:hover {
      color: var(--primary-dark);
    }

    .tabs-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
    }

    .tabs {
      display: flex;
      gap: 0;
      background: var(--primary-light);
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      padding: 16px 25px;
      background: transparent;
      cursor: pointer;
      font-weight: 500;
      white-space: nowrap;
      transition: var(--transition);
      border-bottom: 3px solid transparent;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .tab.active {
      background: var(--card-bg);
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
    }

    .tab-content {
      padding: 0;
    }

    .content {
      display: none;
      padding: 30px;
    }

    .content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content h2 {
      color: var(--primary);
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    .content p {
      margin-bottom: 20px;
      color: var(--text);
      line-height: 1.7;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .feature {
      background: var(--primary-light);
      border-radius: var(--border-radius);
      padding: 25px;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .feature:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
    }

    .feature-icon {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary);
      border-radius: 15px;
      font-size: 24px;
      color: white;
      margin-bottom: 20px;
    }

    .feature-content h3 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: var(--text);
    }

    .feature-content p {
      color: var(--text-light);
      margin-bottom: 0;
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 25px;
      margin-top: 30px;
    }

    .step {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .step-number {
      background: var(--primary);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-content h3 {
      margin-bottom: 8px;
      color: var(--text);
    }

    .step-content p {
      margin-bottom: 15px;
      color: var(--text-light);
    }

    .step-image {
      margin-top: 15px;
    }

    .step-image img {
      width: 100%;
      max-width: 300px;
      border-radius: 10px;
      box-shadow: var(--shadow);
    }

    .rating-section {
      background: var(--primary-light);
      padding: 25px;
      border-radius: var(--border-radius);
      margin-bottom: 30px;
    }

    .stars {
      margin: 15px 0;
    }

    .star {
      cursor: pointer;
      font-size: 28px;
      margin-right: 5px;
      color: #ddd;
      transition: var(--transition);
      display: inline-block;
    }

    .star:hover {
      transform: scale(1.2);
    }

    .star.active {
      color: #f5b50a;
    }

    .review-form {
      background: var(--card-bg);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-family: 'Poppins', sans-serif;
      transition: var(--transition);
    }

    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(78, 84, 200, 0.2);
    }

    .submit-btn {
      background: var(--primary);
      color: white;
      padding: 12px 25px;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: var(--transition);
    }

    .submit-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .reviews-container {
      margin-top: 30px;
    }

    .review-item {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      align-items: center;
    }

    .reviewer-name {
      font-weight: 600;
      color: var(--text);
    }

    .review-date {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .review-stars {
      margin: 10px 0;
      color: #f5b50a;
    }

    .review-message {
      color: var(--text);
      white-space: pre-wrap;
    }

    .load-more {
      text-align: center;
      margin-top: 30px;
    }

    .load-more-btn {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      padding: 10px 25px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .load-more-btn:hover {
      background: var(--primary);
      color: white;
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      width: 100%;
      max-width: 800px;
      background: var(--card-bg);
      border-radius: 15px;
      padding: 30px;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }

    .close-modal {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-light);
      transition: var(--transition);
    }

    .close-modal:hover {
      color: var(--primary);
    }

    .modal-title {
      margin-bottom: 20px;
      color: var(--primary);
    }

    #modal-reviews-list {
      max-height: 60vh;
      overflow: auto;
      padding-right: 10px;
    }

    .loading-container {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0,0,0,0.08);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      text-align: center;
      padding: 30px 0;
      color: var(--text-light);
      margin-top: 50px;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      header {
        padding: 30px 0;
        border-radius: 0 0 20px 20px;
      }
      
      header h1 {
        font-size: 2rem;
      }
      
      .app-header {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      
      .app-stats {
        justify-content: center;
      }
      
      .app-actions {
        justify-content: center;
      }
      
      .tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
      }
      
      .tab {
        padding: 12px 20px;
        font-size: 0.9rem;
      }
      
      .content {
        padding: 20px;
      }
      
      .features-grid {
        grid-template-columns: 1fr;
      }
      
      .step {
        flex-direction: column;
        gap: 15px;
      }
      
      .step-number {
        align-self: flex-start;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0 15px;
      }
      
      header h1 {
        font-size: 1.8rem;
      }
      
      .app-icon {
        width: 70px;
        height: 70px;
        font-size: 30px;
      }
      
      .app-info h2 {
        font-size: 1.5rem;
      }
      
      .stat {
        font-size: 0.85rem;
        padding: 6px 12px;
      }
      
      .install-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
      
      .tab {
        padding: 10px 15px;
        font-size: 0.85rem;
      }
      
      .content {
        padding: 15px;
      }
      
      .content h2 {
        font-size: 1.5rem;
      }
      
      .feature {
        padding: 20px;
      }
      
      .step-image img {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Ujjwal Academy - Study Material App</h1>
      <p>Your comprehensive learning companion for academic success</p>
    </header>

    <div class="app-card">
      <div class="app-header">
        <div class="app-icon"><i class="fas fa-graduation-cap"></i></div>
        <div class="app-info">
          <h2>Ujjwal Academy</h2>
          <p>Empowering students with quality study resources</p>
          <div class="app-stats">
            <div class="stat"><i class="fas fa-download"></i><span id="download-count">0 Downloads</span></div>
            <div class="stat"><i class="fas fa-star"></i><span id="rating-value">0 ★ (0 reviews)</span></div>
            <div class="stat"><i class="fas fa-database"></i><span>45 MB</span></div>
            <div class="stat"><i class="fas fa-tags"></i><span>Education</span></div>
          </div>
        </div>
      </div>

      <div class="app-actions">
        <button class="install-btn" id="install-button"><i class="fas fa-download"></i> Install App</button>
        <a href="#" class="view-details"><i class="fas fa-share-alt"></i> Share this app</a>
      </div>
    </div>

    <div class="tabs-container">
      <div class="tabs">
        <div class="tab active" data-tab="description"><i class="fas fa-info-circle"></i> Description</div>
        <div class="tab" data-tab="install-guide"><i class="fas fa-mobile-alt"></i> How to Install</div>
        <div class="tab" data-tab="reviews"><i class="fas fa-star"></i> Reviews</div>
      </div>

      <div class="tab-content">
        <div class="content active" id="description">
          <h2>Comprehensive Study Materials for Academic Excellence</h2>
          <p>Ujjwal Academy provides meticulously curated study resources designed to help students excel in their academic pursuits. Our app brings everything you need for successful learning right to your fingertips.</p>
          
          <div class="features-grid">
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-sticky-note"></i></div>
              <div class="feature-content">
                <h3>Detailed Notes</h3>
                <p>Well-organized subject notes covering all topics with clear explanations and examples to strengthen your conceptual understanding.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-list-ol"></i></div>
              <div class="feature-content">
                <h3>Step-by-Step Solutions</h3>
                <p>Comprehensive solutions to textbook problems with detailed explanations to help you master problem-solving techniques.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-book"></i></div>
              <div class="feature-content">
                <h3>Subject Digests</h3>
                <p>Concise summaries of each chapter highlighting key concepts, formulas, and important points for quick revision before exams.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-file-alt"></i></div>
              <div class="feature-content">
                <h3>Board Question Papers</h3>
                <p>Previous years' board exam papers with solutions to familiarize you with exam patterns and important questions.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-tasks"></i></div>
              <div class="feature-content">
                <h3>Model Practice Papers</h3>
                <p>Expert-created practice tests designed to simulate actual exam conditions and help you assess your preparation level.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-leaf"></i></div>
              <div class="feature-content">
                <h3>EVS Projects</h3>
                <p>Creative and well-researched Environmental Science projects with guidelines to help you create impressive submissions.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-exclamation-circle"></i></div>
              <div class="feature-content">
                <h3>Important Questions</h3>
                <p>Curated list of high-weightage questions most likely to appear in exams, helping you focus your study efforts efficiently.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-chart-pie"></i></div>
              <div class="feature-content">
                <h3>Exam Weightage Analysis</h3>
                <p>Chapter-wise marks distribution guidance to help you prioritize topics based on their importance in exams.</p>
              </div>
            </div>
            
            <div class="feature">
              <div class="feature-icon"><i class="fas fa-plus-circle"></i></div>
              <div class="feature-content">
                <h3>And Much More!</h3>
                <p>Additional resources including video explanations, mind maps, flashcards, and expert tips to enhance your learning experience.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="content" id="install-guide">
          <h2>How to Install Ujjwal Academy App on Your Device</h2>
          <p>Follow these simple steps to install our study material app on your mobile device:</p>
          
          <div class="steps">
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>Download the App</h3>
                <p>Click on the "Install App" button at the top of this page. The download will begin automatically.</p>
                <div class="step-image">
                  <img src="https://placehold.co/300x200/e6e9ff/4e54c8?text=Click+Install+Button" alt="Install button screenshot">
                </div>
              </div>
            </div>
            
            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>Open the Downloaded File</h3>
                <p>Once downloaded, open the file from your notification panel or downloads folder.</p>
                <div class="step-image">
                  <img src="https://placehold.co/300x200/e6e9ff/4e54c8?text=Open+Downloaded+File" alt="Open downloaded file screenshot">
                </div>
              </div>
            </div>
            
            <div class="step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>Allow Installation from Unknown Sources</h3>
                <p>If prompted, allow installation from unknown sources in your security settings. Don't worry, our app is completely safe.</p>
                <div class="step-image">
                  <img src="https://placehold.co/300x200/e6e9ff/4e54c8?text=Allow+Unknown+Sources" alt="Allow unknown sources screenshot">
                </div>
              </div>
            </div>
            
            <div class="step">
              <div class="step-number">4</div>
              <div class="step-content">
                <h3>Install the App</h3>
                <p>Tap on "Install" and wait for the installation process to complete.</p>
                <div class="step-image">
                  <img src="https://placehold.co/300x200/e6e9ff/4e54c8?text=Tap+Install" alt="Install app screenshot">
                </div>
              </div>
            </div>
            
            <div class="step">
              <div class="step-number">5</div>
              <div class="step-content">
                <h3>Open and Enjoy Learning</h3>
                <p>Once installed, tap "Open" to launch the app and start accessing all the study materials.</p>
                <div class="step-image">
                  <img src="https://placehold.co/300x200/e6e9ff/4e54c8?text=Open+App" alt="Open app screenshot">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="content" id="reviews">
          <div class="rating-section">
            <h2>Rate Our App</h2>
            <div class="stars">
              <span class="star" data-value="1">★</span>
              <span class="star" data-value="2">★</span>
              <span class="star" data-value="3">★</span>
              <span class="star" data-value="4">★</span>
              <span class="star" data-value="5">★</span>
            </div>
            <p id="rating-text">Tap on a star to rate</p>
          </div>

          <div class="review-form" id="review-form" style="display:none;">
            <h3>Share Your Experience</h3>
            <form id="feedback-form">
              <div class="form-group">
                <label for="name">Full Name</label>
                <input type="text" id="name" />
              </div>
              <div class="form-group">
                <label for="message">Your Message</label>
                <textarea id="message" rows="4"></textarea>
              </div>
              <button type="submit" class="submit-btn">Submit Review</button>
            </form>
          </div>

          <div class="reviews-container">
            <h2>User Reviews</h2>
            <div id="reviews-list"><p>Loading reviews...</p></div>
            <div class="load-more"><button id="load-more-btn" class="load-more-btn">Load More Reviews</button></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for all reviews -->
    <div class="modal" id="reviews-modal">
      <div class="modal-content">
        <span class="close-modal" id="close-modal">&times;</span>
        <h2 class="modal-title">All Reviews</h2>
        <div id="modal-reviews-list"></div>
        <div class="loading-container" id="modal-loading" style="display:none;">
          <div class="spinner"></div><p>Loading more reviews...</p>
        </div>
      </div>
    </div>

    <!-- message modal -->
    <div class="modal" id="message-modal">
      <div class="modal-content">
        <span class="close-modal" id="close-message-modal">&times;</span>
        <h2 id="message-title"></h2>
        <p id="message-content"></p>
      </div>
    </div>

    <footer><p>© 2025 Ujjwal Academy. All rights reserved.</p></footer>
  </div>

  <!-- ===== Updated JS (connected to Google Apps Script) ===== -->
  <script>
    // Replace with your deployed Apps Script URL
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyvSemx4vG1e1qhum7fiERghpjJWfU_Ljwe6GP66G8RygrPFbdpCslW0VhYd5fsRkdhFw/exec';

    // Spreadsheet config (✅ can be changed anytime without editing Google Script)
    const spreadsheetId = "1lZAm1BsDnhSkPXBpdHYS11hJtJCcSgdrxUZz3IFVYFY"; 
    const sheetName = "Review"; 

    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.content');
      const stars = document.querySelectorAll('.star');
      const ratingText = document.getElementById('rating-text');
      const reviewForm = document.getElementById('review-form');
      const feedbackForm = document.getElementById('feedback-form');
      const reviewsList = document.getElementById('reviews-list');
      const loadMoreBtn = document.getElementById('load-more-btn');
      const installBtn = document.getElementById('install-button');
      const reviewsModal = document.getElementById('reviews-modal');
      const closeModal = document.getElementById('close-modal');
      const modalReviewsList = document.getElementById('modal-reviews-list');
      const messageModal = document.getElementById('message-modal');
      const closeMessageModal = document.getElementById('close-message-modal');
      const messageTitle = document.getElementById('message-title');
      const messageContent = document.getElementById('message-content');
      const modalLoading = document.getElementById('modal-loading');

      let currentRating = 0;
      let allReviews = [];
      const pageLimit = 5;
      let modalOffset = 0, modalLoadingFlag = false, modalAllLoaded = false;

      // Initialize
      fetchAppData();
      fetchReviews();

      // Tabs
      tabs.forEach(tab => tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        contents.forEach(content => {
          content.classList.remove('active');
          if (content.id === tabId) content.classList.add('active');
        });
      }));
	  
	  // Replace this with your actual app store link
      const appInstallLink = "https://play.google.com/store/apps/details?id=com.example.myapp";
      document.getElementById("install-button").addEventListener("click", () => {
        window.open(appInstallLink, "_blank"); // opens in new tab
      });

      // Stars
      stars.forEach(star => star.addEventListener('click', () => {
        const value = parseInt(star.getAttribute('data-value'), 10);
        currentRating = value;
        stars.forEach(s => s.classList.toggle('active', parseInt(s.getAttribute('data-value'),10) <= value));
        ratingText.textContent = `You rated ${value} star${value > 1 ? 's' : ''}`;
        if (reviewForm) reviewForm.style.display = 'block';
      }));

      // Submit review
      if (feedbackForm) feedbackForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const message = document.getElementById('message').value.trim();
        if (!currentRating) { showMessage('Error','Please select a rating.'); return; }
        if (!name) { showMessage('Error','Please enter your full name.'); return; }
        if (!message) { showMessage('Error','Please enter a message.'); return; }
        submitReview(currentRating, name, message);
      });

      // Load more -> open modal and lazy load
      if (loadMoreBtn) loadMoreBtn.addEventListener('click', () => {
        modalReviewsList.innerHTML = '';
        modalOffset = 0; modalAllLoaded = false; modalLoadingFlag = false;
        reviewsModal.style.display = 'flex';
        modalLoading.style.display = 'block';
        loadMoreReviewsInModal();
      });

      // Close modals
      if (closeModal) closeModal.addEventListener('click', () => reviewsModal.style.display = 'none');
      if (closeMessageModal) closeMessageModal.addEventListener('click', () => messageModal.style.display = 'none');
      window.addEventListener('click', e => {
        if (e.target === reviewsModal) reviewsModal.style.display = 'none';
        if (e.target === messageModal) messageModal.style.display = 'none';
      });

      // Modal scroll lazy load
      if (modalReviewsList) modalReviewsList.addEventListener('scroll', () => {
        if (modalAllLoaded || modalLoadingFlag) return;
        const threshold = 150;
        if (modalReviewsList.scrollHeight - modalReviewsList.scrollTop - modalReviewsList.clientHeight < threshold) loadMoreReviewsInModal();
      });

      // Install button
      if (installBtn) installBtn.addEventListener('click', () => {
        installBtn.disabled = true;
        const oldText = installBtn.textContent;
        installBtn.innerHTML = '<div class="spinner"></div>';
        recordDownload().finally(() => {
          installBtn.disabled = false;
          installBtn.textContent = oldText;
        });
      });

      /* ---------- Network functions ---------- */

      function fetchAppData() {
        fetch(`${scriptURL}?action=get_stats&spreadsheetId=${spreadsheetId}&sheetName=${sheetName}`)
          .then(r => r.json())
          .then(data => {
            if (data && data.success) {
              const downloads = data.downloads || 0;
              const avgRating = data.avgRating || 0;
              const totalRatings = Number(data.totalRating) || 0;
              
              document.getElementById('download-count').textContent = 
                `${downloads >= 1000 ? (downloads/1000).toFixed(0)+'K+' : downloads+'+'} Downloads`;
              
              document.getElementById('rating-value').textContent = 
                `${avgRating.toFixed(1)} ★ (${totalRatings >= 1000 ? (totalRatings/1000).toFixed(1)+'K' : totalRatings} reviews)`;
            }
          }).catch(err => console.error('fetchAppData error', err));
      }

      function fetchReviews() {
        fetch(`${scriptURL}?action=get_reviews&limit=${pageLimit}&offset=0&spreadsheetId=${spreadsheetId}&sheetName=${sheetName}`)
          .then(r => r.json())
          .then(data => {
            if (data && data.success && Array.isArray(data.reviews) && data.reviews.length) {
              allReviews = data.reviews;
              displayReviews(allReviews, reviewsList);
            } else {
              reviewsList.innerHTML = '<p>No reviews yet. Be the first to review!</p>';
            }
          }).catch(err => { console.error('fetchReviews error', err); reviewsList.innerHTML = '<p>Error loading reviews.</p>'; });
      }

      function displayReviews(reviews, container) {
        container.innerHTML = '';
        if (!reviews || !reviews.length) { container.innerHTML = '<p>No reviews yet.</p>'; return; }
        reviews.forEach(review => {
          const reviewEl = document.createElement('div');
          reviewEl.className = 'review-item';
          const ratingN = parseInt(review.rating || 0, 10);
          let starsHtml = ''; for (let i=0;i<5;i++) starsHtml += i < ratingN ? '★' : '☆';
          reviewEl.innerHTML = `<div class="review-header"><span class="reviewer-name">${escapeHtml(review.name)}</span><span class="review-date">${escapeHtml(formatDate(review.date))}</span></div><div class="review-stars">${starsHtml}</div><div class="review-message">${escapeHtml(review.message)}</div>`;
          container.appendChild(reviewEl);
        });
      }

      function loadMoreReviewsInModal() {
        if (modalLoadingFlag || modalAllLoaded) return;
        modalLoadingFlag = true;
        modalLoading.style.display = 'block';
        fetch(`${scriptURL}?action=get_reviews&limit=${pageLimit}&offset=${modalOffset}&spreadsheetId=${spreadsheetId}&sheetName=${sheetName}`)
          .then(res => res.json())
          .then(data => {
            modalLoading.style.display = 'none';
            modalLoadingFlag = false;
            if (data && data.success && Array.isArray(data.reviews)) {
              const batch = data.reviews;
              if (!batch.length) { if (modalOffset === 0) modalReviewsList.innerHTML = '<p>No reviews found.</p>'; modalAllLoaded = true; return; }
              appendReviewsToModal(batch);
              modalOffset += batch.length;
              if (batch.length < pageLimit) modalAllLoaded = true;
            } else {
              modalReviewsList.innerHTML = '<p>Error loading reviews.</p>';
            }
          }).catch(err => { console.error('modal load error', err); modalLoading.style.display='none'; modalLoadingFlag=false; modalReviewsList.innerHTML = '<p>Error loading reviews.</p>'; });
      }

      function appendReviewsToModal(reviews) {
        reviews.forEach(review => {
          const reviewEl = document.createElement('div');
          reviewEl.className = 'review-item';
          const ratingN = parseInt(review.rating || 0, 10);
          let starsHtml = ''; for (let i=0;i<5;i++) starsHtml += i < ratingN ? '★' : '☆';
          reviewEl.innerHTML = `<div class="review-header"><span class="reviewer-name">${escapeHtml(review.name)}</span><span class="review-date">${escapeHtml(formatDate(review.date))}</span></div><div class="review-stars">${starsHtml}</div><div class="review-message">${escapeHtml(review.message)}</div>`;
          modalReviewsList.appendChild(reviewEl);
        });
      }

      function submitReview(rating, name, message) {
        const btn = feedbackForm.querySelector('button');
        const orig = btn.textContent;
        btn.innerHTML = '<div class="spinner"></div>'; btn.disabled = true;
        const body = new URLSearchParams({ 
          action:'submit_review', 
          rating:String(rating), 
          name:name, 
          message:message,
          spreadsheetId: spreadsheetId,
          sheetName: sheetName
        }).toString();
        fetch(scriptURL, { method:'POST', headers:{ 'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8' }, body })
          .then(r => r.json())
          .then(data => {
            btn.textContent = orig; btn.disabled = false;
            if (data && data.success) {
              showMessage('Success','Thank you for your review! It has been submitted successfully.');
              feedbackForm.reset(); stars.forEach(s=>s.classList.remove('active')); ratingText.textContent='Tap on a star to rate'; if (reviewForm) reviewForm.style.display='none'; currentRating=0;
              fetchAppData(); fetchReviews();
            } else showMessage('Error',(data && data.error) || 'Error submitting review.');
          }).catch(err => { console.error('submit error', err); btn.textContent=orig; btn.disabled=false; showMessage('Error','Error submitting review.'); });
      }

      function recordDownload() {
        const body = new URLSearchParams({ 
          action:'increase_download',
          spreadsheetId: spreadsheetId,
          sheetName: sheetName
        }).toString();
        return fetch(scriptURL, { method:'POST', headers:{ 'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8' }, body })
          .then(r => r.json())
          .then(data => {
            if (data && data.success) {
              const downloads = data.downloads || data.download_count || 0;
              document.getElementById('download-count').textContent = `${downloads >= 1000 ? (downloads/1000).toFixed(0)+'K+' : downloads+'+'} Downloads`;
              showMessage('Success','Thank you for installing Ujjwal Academy App! Your download will begin shortly.');
            } else showMessage('Info','Thank you for installing Ujjwal Academy App!');
          }).catch(err => { console.error('download error', err); showMessage('Info','Thank you for installing Ujjwal Academy App!'); });
      }

      function showMessage(title, content) {
        messageTitle.textContent = title; messageContent.textContent = content; messageModal.style.display = 'flex';
      }

      /* helpers */
      function formatDate(d) {
        if (!d) return '';
        try {
          if (typeof d === 'string') {
            const maybe = new Date(d); if (!isNaN(maybe)) return maybe.toLocaleDateString();
            return d.length > 16 ? d.slice(0,16) : d;
          }
          const dt = new Date(d); if (!isNaN(dt)) return dt.toLocaleDateString(); return String(d);
        } catch { return String(d); }
      }
      function escapeHtml(s) { if (s===null||s===undefined) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
    });
  </script>

</body>
</html>