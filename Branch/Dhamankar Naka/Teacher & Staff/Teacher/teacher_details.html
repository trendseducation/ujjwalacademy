<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Details</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.4/lottie.min.js"></script>
	<script src="https://trendseducation.github.io/ujjwalacademy/Study%20Material/loginscript.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }
        h2 {
            text-align: center;
            padding: 20px;
            background-color: #6200ea;
            color: white;
            margin: 0;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            background-color: #6200ea;
            padding: 10px 0;
        }
        .tab {
            flex: 1;
            padding: 12px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }
        .tab:hover, .tab.active {
            background-color: #3700b3;
        }
        .tab-content {
            display: none;
            padding: 20px;
			width: 100%;
            padding: 10px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .tab-content.active {
            display: block;
			
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            word-wrap: break-word;
        }
        th {
            background-color: #f4f4f4;
            font-weight: bold;
        }
        button {
            padding: 10px 20px;
            background-color: #6200ea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #3700b3;
        }
        input, button {
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        flex-direction: column;
        color: white;
        font-family: Arial, sans-serif;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
		.form-container {
            background-color: #ffffff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
		.page2 {
			font-weight: bold;
		}

        .form-container h2 {
            margin-bottom: 20px;
            font-size: 24px;
            color: #333333;
            text-align: center;
        }
		.page3 {
		    font-family: Arial, sans-serif;
		    display: flex;
		    justify-content: center;
            align-items: center;
			padding: 10px;
		}

      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        font-weight: 500;
        color: #495057;
        margin-bottom: 8px;
      }
      .form-control {
        border-radius: 8px;
		width: 100%;
        padding: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #ced4da;
      }

        .tab-content label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555555;
        }

        .tab-content input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .tab-content input:focus {
            border-color: #007BFF;
            outline: none;
        }

        .submit-btn {
            width: 100%;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #0056b3;
        }
		
		.button-group {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .editbtn, .deletebtn {
		    display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .editbtn {
            background-color: #007BFF;
            color: #ffffff;
            border: none;
        }

        .editbtn:hover {
            background-color: #0056b3;
        }

        .deletebtn {
            background-color: #d9534f;
            color: #ffffff;
            border: none;
        }

        .deletebtn:hover {
            background-color: #c9302c;
        }
		<!... search Bar >
		
		.search-bar-container {
              display: flex;
              justify-content: center;
              align-items: center;
              margin: 10px 0;
              width: 100%;
    }

    .search-bars {
        width: 90%;
        max-width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .search-bar:focus {
        border-color: #6200ea;
        outline: none;
        box-shadow: 0px 4px 6px rgba(98, 0, 234, 0.2);
    }
		
        @media (max-width: 768px) {
            table {
                font-size: 14px;
                margin: 10px;
            }
            .tabs {
                text-align: center;
            }
            .tab {
                padding: 10px;
            }
			.search-bar {
            width: 90%;
            font-size: 14px;
        }
        }
		
    /* Loading Overlay */
#loading {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 1002; /* Ensure loading spinner is above the popup */
}

.loading-content {
  text-align: center;
  color: white;
}

#spinner {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  border: 8px solid #f3f3f3; /* Light grey */
  border-top: 8px solid #3498db; /* Blue */
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#loadingPercentage {
  margin-top: 10px;
  font-size: 18px;
}

/* Disabled Buttons */
#popupDelete:disabled, #popupClose:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Popup Container */
#popupContainer {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

#popupContent {
  background: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  max-width: 400px; /* Increased size */
  width: 90%; /* Responsive width */
}

#popupAnimation {
  width: 100px;
  height: 100px;
  margin: 0 auto;
}

#popupMessage {
  margin: 15px 0;
  font-size: 16px;
}

#popupButtons {
  display: flex;
  justify-content: center;
  gap: 10px; /* Space between buttons */
}

/* Popup Buttons */
#popupDelete, #popupClose {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  display: inline-block; /* Ensure buttons are inline */
}

#popupDelete {
  background: #ff4d4d; /* Red for delete button */
  color: white;
}

#popupDelete:hover {
  background: #cc0000;
}

#popupClose {
  background: #007bff; /* Blue for close button */
  color: white;
}

#popupClose:hover {
  background: #0056b3;
}

/* Mobile Responsiveness */
@media (max-width: 600px) {
  #popupContent {
    padding: 15px;
    max-width: 90%; /* Full width on small screens */
  }

  #popupMessage {
    font-size: 14px;
  }

  #popupDelete, #popupClose {
    padding: 8px 16px;
    font-size: 12px;
  }
}
    </style>
</head>
<body>
    <h2>Teacher Details</h2>
    <div class="tabs">
        <div class="tab active" data-tab="tableView">Teacher List</div>
        <div class="tab" data-tab="detailsView">Teacher Details</div>
        <div class="tab" data-tab="editView">Edit Details</div>
    </div>

<!-- Loading Overlay -->
<div id="loading">
  <div class="loading-content">
    <div id="spinner"></div>
    <div id="loadingPercentage">0%</div>
  </div>
</div>
			  
    <div style= "display: flex; justify-content: center; align-items: center;">
    <input
        type="text"
        id="searchInput"
        class="search-bars"
        placeholder="Search in Name"
        oninput="searchTable()"
    />
</div>
    <!-- Data Table View (Page 1) -->
    <div id="tableView" class="tab-content active">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Teacher Name</th>
                    <th>Stream</th>
                    <th>View More</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Details View (Page 2) -->
    <div id="detailsView" class="tab-content">
	<div class="page3">
        <table>
            <tr>
                <td class="page2">ID</td>
                <td id="detailsId"></td>
            </tr>
			<tr>
               <td class="page2">Academic Year</td>
                <td id="detailsAcademic"></td>
            </tr>
            <tr>
               <td class="page2">Teacher Name</td>
                <td id="detailsName"></td>
            </tr>
			<tr>
               <td class="page2">Stream</td>
                <td id="detailsStream"></td>
            </tr>
			<tr>
               <td class="page2">Other Course Name</td>
                <td id="detailsSubject"></td>
            </tr>
			<tr>
                <td class="page2">Phone No</td>
                <td id="detailsPhone1"></td>
            </tr>
			<tr>
                <td class="page2">Alternate Phone No</td>
                <td id="detailsPhone2"></td>
            </tr>
            <tr>
                <td class="page2">Email</td>
                <td id="detailsEmail"></td>
            </tr>
            <tr>
                <td class="page2">Gender</td>
                <td id="detailsGender"></td>
            </tr>
			<tr>
                <td class="page2">Qualification</td>
                <td id="detailsQualification"></td>
            </tr>
			 <!-- Experience 1 -->
            <tr id="rowExp1" class="hidden">
            <td class="page2">Experience Detail 1</td>
            <td id="detailsExp1"></td>
        </tr>
        <tr id="rowExp2" class="hidden">
            <td class="page2">Experience Detail 2</td>
            <td id="detailsExp2"></td>
        </tr>
        <tr id="rowExp3" class="hidden">
            <td class="page2">Experience Detail 3</td>
            <td id="detailsExp3"></td>
        </tr>
        <tr id="rowExp4" class="hidden">
            <td class="page2">Experience Detail 4</td>
            <td id="detailsExp4"></td>
			 <tr>
                <td class="page2">Address</td>
                <td id="detailsAddress"></td>
            </tr>
			<tr>
                <td class="page2">Note</td>
                <td id="detailsNote"></td>
            </tr>
        </table></div>
        <div class="action-buttons">
		<div class="button-group">
            <button id="editButton" class="editbtn">Edit</button>
            <button id="deleteButton" class="deletebtn">Delete</button>
        </div></div>
    </div>

    <!-- Edit View (Page 3) -->
    <div id="editView" class="tab-content">
	<div class="page3">
	<div class="form-container">
        <form id="editForm">
            <label for="editName">Teacher Name<span style="color: red;"> *</span></label>
            <input type="text" id="editName" required>
			<label for="editStream">Stream<span style="color: red;"> *</span></label>
			<input type="text" id="editStream" required>
			<label for="editSubject">Other Course Name<span style="color: red;"> *</span></label>
			<input type="text" id="editSubject" required>
			<label for="editPhone1">Phone Number<span style="color: red;"> *</span></label>
            <input 
                type="tel" 
                id="editPhone1" 
                name="phone" 
                pattern="[0-9]{10}" 
                maxlength="10" 
                required 
                placeholder="Enter 10-digit mobile number" 
                title="Please enter a 10-digit mobile number"
				required
            />
			<label for="editPhone2">Alternate Phone Number</label>
            <input 
                type="tel" 
                id="editPhone2" 
                name="phone" 
                pattern="[0-9]{10}" 
                maxlength="10" 
                required 
                placeholder="Enter 10-digit mobile number" 
                title="Please enter a 10-digit mobile number"
            />
            <label for="editEmail">Email</label>
            <input type="email" id="editEmail" placeholder="Enter your Email id"/>
        <div class="form-group">
		<label for="editGender">Gender<span style="color: red;"> *</span></label>
            <select class="form-control" id="editGender" name="gender" required>
                <option value="">Select your gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
    </div>
			<label for="editQualification">Qualification</label>
            <input type="text" id="editQualification">
			<!-- Experience 1 -->
			<div id="exp1">
            <label for="editExp1">Experience Detail 1</label>
            <input type="text" id="editExp1" value="wait"/>
			</div>
            <!-- Experience 2 -->
            <div id="exp2" style="display: none;">
                <label for="editExp2">Experience Detail 2</label>
                <input type="text" id="editExp2"/>
            </div>
            <!-- Experience 3 -->
            <div id="exp3" style="display: none;">
                <label for="editExp3">Experience Detail 3</label>
                <input type="text" id="editExp3"/>
            </div>
            <!-- Experience 4 -->
            <div id="exp4" style="display: none;">
                <label for="editExp4">Experience Detail 4</label>
                <input type="text" id="editExp4" />
            </div>
			<label for="editAddress">Address<span style="color: red;"> *</span></label>
            <input type="text" id="editAddress" required>
			<label for="editNote">Any Note</label>
            <input type="text" id="editNote">
			
            <button type="submit" class="submit-btn">Update</button>
        </form>
    </div></div></div>
	
<!-- Popup Container -->
<div id="popupContainer">
  <div id="popupContent">
    <div id="popupAnimation"></div>
    <div id="popupMessage"></div>
    <div id="popupButtons">
      <button id="popupDelete">Delete</button>
      <button id="popupClose">Close</button>
    </div>
  </div>
</div>

   <script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbwD-29kpCjkWmA4G0GdHC1IXpbF7GaCpZb5NN-ufwiUO9y12QPIVRYdIHmFmeWUHEx9/exec";
  const SPREADSHEET_ID = "13LTaaP2v4aepRG-05dC1caYxRTNMSjPESMga7Oqwv5Q";
const sheetName = "Teacher_Details"; // Change this to any sheet name

// Lottie Animations
const successAnimation = "https://assets10.lottiefiles.com/packages/lf20_5tkzkblw.json"; // Replace with your Lottie URL
const errorAnimation = "https://assets10.lottiefiles.com/packages/lf20_qp1q7mct.json"; // Replace with your Lottie URL
const confirmAnimation = "https://assets10.lottiefiles.com/packages/lf20_5tkzkblw.json"; // Replace with your Lottie URL

// Tab switching logic
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

const loadingOverlay = document.getElementById("loading");
let selectedRowData = null;

// Show loading overlay
function showLoading() {
  const loadingOverlay = document.getElementById("loading");
  loadingOverlay.style.display = "flex";
  updateLoadingPercentage(0);
  simulateLoading();
}

// Hide loading overlay
function hideLoading() {
  const loadingOverlay = document.getElementById("loading");
  loadingOverlay.style.display = "none";
}

// Update loading percentage
function updateLoadingPercentage(percentage) {
  const percentageElement = document.getElementById("loadingPercentage");
  percentageElement.textContent = `${percentage}%`;
}

// Simulate loading progress
function simulateLoading() {
  let percentage = 0;
  const interval = setInterval(() => {
    percentage += 10;
    updateLoadingPercentage(percentage);
    if (percentage >= 100) {
      clearInterval(interval);
    }
  }, 200);
}

let currentAnimation = null; // Track the current Lottie animation

// Show popup with Lottie animation and dynamic buttons
function showPopup(animationUrl, message, showDeleteButton = false) {
  const popupContainer = document.getElementById("popupContainer");
  const popupAnimation = document.getElementById("popupAnimation");
  const popupMessage = document.getElementById("popupMessage");
  const popupDelete = document.getElementById("popupDelete");
  const popupClose = document.getElementById("popupClose");

  // Clear previous animation
  if (currentAnimation) {
    currentAnimation.destroy();
  }

  // Load new animation
  currentAnimation = lottie.loadAnimation({
    container: popupAnimation,
    renderer: "svg",
    loop: false,
    autoplay: true,
    path: animationUrl,
  });

  // Set message
  popupMessage.textContent = message;

  // Show/hide buttons based on context
  if (showDeleteButton) {
    popupDelete.style.display = "inline-block"; // Show Delete button
  } else {
    popupDelete.style.display = "none"; // Hide Delete button
  }
  popupClose.style.display = "inline-block"; // Always show Close button

  // Display popup
  popupContainer.style.display = "flex";
}

// Close popup
document.getElementById("popupClose").addEventListener("click", () => {
  document.getElementById("popupContainer").style.display = "none";
});

// Fetch data from Google Sheet
async function fetchData() {
  showLoading();
  try {
    const response = await fetch(`${scriptURL}?action=fetchData&sheetName=${sheetName}&spreadsheetId=${SPREADSHEET_ID}`);
    const result = await response.json();
    if (result.success) {
      renderTable(result.data);
    } else {
      showPopup(errorAnimation, result.message);
    }
  } catch (error) {
    showPopup(errorAnimation, "Error fetching data: " + error.message);
  }
  hideLoading();
}

// Render table data
function renderTable(data) {
  const tableBody = document.querySelector("#dataTable tbody");
  tableBody.innerHTML = "";
  data.slice(1).forEach((rowData, rowIndex) => {
    const tableRow = document.createElement("tr");
    tableRow.dataset.rowIndex = rowIndex + 2;
    tableRow.innerHTML = `
      <td>${rowIndex + 1}</td>
      <td>${rowData[1]}</td>
      <td>${rowData[2] || ''}</td>
      <td>
        <button onclick="viewDetails(${rowIndex + 2})">Get Details</button>
      </td>
    `;
    tableBody.appendChild(tableRow);
  });
}

// View details of a row
function viewDetails(rowIndex) {
  showTab('detailsView');
  selectedRowData = rowIndex;
  loadDetails(selectedRowData);
}

// Load details of a row
async function loadDetails(rowIndex) {
  showLoading();
  try {
    const response = await fetch(`${scriptURL}?action=fetchData&sheetName=${sheetName}&spreadsheetId=${SPREADSHEET_ID}`);
    const result = await response.json();
    const rowData = result.data[rowIndex - 1];
    document.getElementById("detailsId").textContent = rowIndex - 1;
    document.getElementById("detailsAcademic").textContent = rowData[0];
                document.getElementById("detailsName").textContent = rowData[1];
				document.getElementById("detailsStream").textContent = rowData[2];
				document.getElementById("detailsSubject").textContent = rowData[3];
				document.getElementById("detailsPhone1").textContent = rowData[4];
				document.getElementById("detailsPhone2").textContent = rowData[5];
				document.getElementById("detailsEmail").textContent = rowData[6];
				document.getElementById("detailsGender").textContent = rowData[7];
                document.getElementById("detailsQualification").textContent = rowData[8];
				if (rowData[9] && rowData[9].trim() !== "") {
    document.getElementById("detailsExp1").textContent = rowData[9];
    document.getElementById("detailsExp1").closest('tr').style.display = ""; // Show the row
} else {
    document.getElementById("detailsExp1").closest('tr').style.display = "none"; // Hide the row
}
				if (rowData[10] && rowData[10].trim() !== "") {
    document.getElementById("detailsExp2").textContent = rowData[10];
    document.getElementById("detailsExp2").closest('tr').style.display = ""; // Show the row
} else {
    document.getElementById("detailsExp2").closest('tr').style.display = "none"; // Hide the row
}
				if (rowData[11] && rowData[11].trim() !== "") {
    document.getElementById("detailsExp3").textContent = rowData[11];
    document.getElementById("detailsExp3").closest('tr').style.display = ""; // Show the row
} else {
    document.getElementById("detailsExp3").closest('tr').style.display = "none"; // Hide the row
}
				if (rowData[12] && rowData[12].trim() !== "") {
    document.getElementById("detailsExp4").textContent = rowData[12];
    document.getElementById("detailsExp4").closest('tr').style.display = ""; // Show the row
} else {
    document.getElementById("detailsExp4").closest('tr').style.display = "none"; // Hide the row
}
				document.getElementById("detailsAddress").textContent = rowData[13];
				document.getElementById("detailsNote").textContent = rowData[14];
  } catch (error) {
    showPopup(errorAnimation, "Error loading details: " + error.message, false); // Show only Close button
  }
  hideLoading();
}

// Show a specific tab
function showTab(tabId) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tabContent => tabContent.classList.remove('active'));
  document.querySelector(`.tab[data-tab=${tabId}]`).classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// Edit button logic
document.getElementById("editButton").addEventListener('click', () => {
  showTab('editView');
  loadEditForm(selectedRowData);
});

// Delete button logic
document.getElementById("deleteButton").addEventListener('click', async () => {
  showPopup(confirmAnimation, "Are you sure you want to delete this data?", true); // Show Delete and Close buttons

  // Handle delete button click
  document.getElementById("popupDelete").addEventListener("click", async () => {
    const popupDelete = document.getElementById("popupDelete");
    const popupClose = document.getElementById("popupClose");

    // Disable delete and close buttons
    popupDelete.disabled = true;
    popupClose.disabled = true;

    // Show loading spinner above the popup
    showLoading();

    try {
      const response = await fetch(`${scriptURL}?action=deleteRow&row=${selectedRowData}&sheetName=${sheetName}&spreadsheetId=${SPREADSHEET_ID}`);
      const result = await response.json();
      showPopup(successAnimation, result.message, false); // Show only Close button
      fetchData();
      showTab('tableView');
    } catch (error) {
      showPopup(errorAnimation, "Error deleting row: " + error.message, false); // Show only Close button
    } finally {
      hideLoading();
      document.getElementById("popupContainer").style.display = "none"; // Close popup after delete
      popupDelete.disabled = false; // Re-enable delete button
      popupClose.disabled = false; // Re-enable close button
    }
  });
});

// Load edit form with data
function loadEditForm(rowIndex) {
  showLoading();
  fetch(`${scriptURL}?action=fetchData&sheetName=${sheetName}&spreadsheetId=${SPREADSHEET_ID}`)
    .then(response => response.json())
    .then(result => {
      const rowData = result.data[rowIndex - 1];
      document.getElementById("editName").value = rowData[1];
					document.getElementById("editStream").value = rowData[2];
					document.getElementById("editSubject").value = rowData[3];
					document.getElementById("editPhone1").value = rowData[4];
					document.getElementById("editPhone2").value = rowData[5];
                    document.getElementById("editEmail").value = rowData[6] || '';
					document.getElementById("editGender").value = rowData[7] || '';
					document.getElementById("editQualification").value = rowData[8];
					document.getElementById("editExp1").value = rowData[9];
					document.getElementById("editExp2").value = rowData[10];
					document.getElementById("editExp3").value = rowData[11];
					document.getElementById("editExp4").value = rowData[12];
					document.getElementById("editAddress").value = rowData[13];
					document.getElementById("editNote").value = rowData[14];
    })
    .catch(error => showPopup(errorAnimation, "Error loading edit form: " + error.message))
    .finally(() => hideLoading());
}

// Update button logic
document.getElementById("editForm").addEventListener('submit', async (e) => {
  e.preventDefault();
  const updatedData = {
    name: document.getElementById("editName").value,
				stream: document.getElementById("editStream").value,
				subject: document.getElementById("editSubject").value,
				phone1: document.getElementById("editPhone1").value,
				phone2: document.getElementById("editPhone2").value,
                email: document.getElementById("editEmail").value,
                gender: document.getElementById("editGender").value,
				qualification: document.getElementById("editQualification").value,
				experience1: document.getElementById("editExp1").value,
				experience2: document.getElementById("editExp2").value,
				experience3: document.getElementById("editExp3").value,
				experience4: document.getElementById("editExp4").value,
				address: document.getElementById("editAddress").value,
				note: document.getElementById("editNote").value
  };
  const updates = [
    { row: selectedRowData, col: 2, value: updatedData.name },
                { row: selectedRowData, col: 3, value: updatedData.stream },
				{ row: selectedRowData, col: 4, value: updatedData.subject },
				{ row: selectedRowData, col: 5, value: updatedData.phone1 },
				{ row: selectedRowData, col: 6, value: updatedData.phone2 },
				{ row: selectedRowData, col: 7, value: updatedData.email },
                { row: selectedRowData, col: 8, value: updatedData.gender },
				{ row: selectedRowData, col: 9, value: updatedData.qualification },
				{ row: selectedRowData, col: 10, value: updatedData.experience1 },
				{ row: selectedRowData, col: 11, value: updatedData.experience2 },
				{ row: selectedRowData, col: 12, value: updatedData.experience3 },
				{ row: selectedRowData, col: 13, value: updatedData.experience4 },
				{ row: selectedRowData, col: 14, value: updatedData.address },
				{ row: selectedRowData, col: 15, value: updatedData.note }
  ];
  try {
    showLoading();
    const updatesParam = encodeURIComponent(JSON.stringify(updates));
    const response = await fetch(`${scriptURL}?action=updateData&updates=${updatesParam}&sheetName=${sheetName}&spreadsheetId=${SPREADSHEET_ID}`);
    const result = await response.json();
    showPopup(successAnimation, result.message);
    showTab('tableView');
    fetchData();
  } catch (error) {
    showPopup(errorAnimation, "Error updating row: " + error.message);
  }
  hideLoading();
});

// Search table data
function searchTable() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const table = document.getElementById("dataTable");
  const rows = table.getElementsByTagName("tr");
  let hasResults = false;

  for (let i = 1; i < rows.length; i++) {
    const cells = rows[i].getElementsByTagName("td");
    let match = false;

    for (let j = 0; j < cells.length; j++) {
      if (cells[j].textContent.toLowerCase().includes(input)) {
        match = true;
        break;
      }
    }

    if (match) {
      rows[i].style.display = ""; // Show row
      hasResults = true;
    } else {
      rows[i].style.display = "none"; // Hide row
    }
  }

  // Show or hide "No results" message
  const noResults = document.getElementById("noResults");
  noResults.style.display = hasResults ? "none" : "block";
}

// Edit Experience Function

// Function to toggle visibility of experience fields dynamically
function toggleExperienceFields() {
    const totalFields = 4; // Total number of experience fields

    for (let i = 1; i <= totalFields; i++) {
        const currentField = document.getElementById(`editExp${i}`);
        const nextFieldDiv = document.getElementById(`exp${i + 1}`);

        if (!currentField) {
            console.error(`Field editExp${i} not found.`);
            continue;
        }

        // Check if the current field has content
        if (currentField.value.trim() !== '') {
            // Show the current field (useful if hidden initially)
            currentField.closest('div').style.display = 'block';

            // Show the next field if it exists
            if (nextFieldDiv) {
                nextFieldDiv.style.display = 'block';
            }
        } else {
            // Hide all subsequent fields if the current one is empty
            for (let j = i + 1; j <= totalFields; j++) {
                const fieldDiv = document.getElementById(`exp${j}`);
                if (fieldDiv) {
                    fieldDiv.style.display = 'none';
                    const input = fieldDiv.querySelector('input');
                    if (input) {
                        input.value = ''; // Clear the value of the hidden input
                    }
                }
            }
            break; // Stop further checks once an empty field is found
        }
    }
}

// Initialize the fields and add event listeners
document.addEventListener('DOMContentLoaded', () => {
    const totalFields = 4; // Total number of experience fields

    for (let i = 1; i <= totalFields; i++) {
        const field = document.getElementById(`editExp${i}`);
        if (field) {
            // Add an event listener for real-time input changes
            field.addEventListener('input', toggleExperienceFields);
        }
    }

    // Trigger the function on page load to initialize the state
    toggleExperienceFields();
});

// Initial data load on page load
window.onload = () => {
  showLoading();
  fetchData();
};
</script>
</body>
</html>
